{% extends "base.html" %}

{% block title %}Report an Issue - Sahayak{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="text-center mb-5">
        <h1 class="display-5">Create a New Report</h1>
        <p class="lead text-muted">Follow the simple steps below to help us identify and resolve civic issues.</p>
    </div>

    <!-- Step 1: Image Selection -->
    <div id="report-step-1" class="report-step">
        <div class="step-header mb-4">
            <h3>Provide an Image</h3>
        </div>
        <p id="step-1-prompt" class="text-center mb-4">How would you like to provide an image of the issue?</p>
        
        <div id="initial-choice-buttons" class="d-grid gap-3 d-md-flex justify-content-md-center mb-3">
            <button id="live-capture-btn" class="btn btn-primary btn-lg"><i class="fas fa-camera me-2"></i> Take a Live Photo</button>
            <button id="upload-btn" class="btn btn-secondary btn-lg"><i class="fas fa-upload me-2"></i> Upload from Device</button>
        </div>

        <input type="file" id="image-upload-input" class="d-none" accept="image/*">

        <div id="live-camera-view" class="mt-4 text-center" style="display: none;">
            <video id="camera-video" playsinline autoplay class="img-fluid rounded mb-3 shadow-sm" style="max-height: 400px; border: 1px solid var(--border-color-light);"></video>
            <div>
                <button id="capture-btn" class="btn btn-danger me-2"><i class="fas fa-circle me-1"></i> Capture</button>
                <button id="cancel-camera-btn" class="btn btn-warning">Cancel</button>
            </div>
            <canvas id="camera-canvas" class="d-none"></canvas>
        </div>

        <div id="image-preview-container" class="mt-4 text-center" style="display: none;">
            <h4 class="mb-3">Image Preview</h4>
            <img id="image-preview" src="#" alt="Image preview" class="img-fluid rounded mb-3 shadow" style="max-height: 400px;"/>
            <div>
                <button id="next-step-btn" class="btn btn-success me-2">Confirm Image & Continue <i class="fas fa-arrow-right ms-2"></i></button>
                <button id="try-again-btn" class="btn btn-secondary">Try Again</button>
            </div>
        </div>
    </div>

    <!-- Step 2: Location Access -->
    <div id="report-step-2" class="report-step" style="display: none;">
        <div class="step-header mb-4">
            <h3>Pinpoint the Location</h3>
        </div>
        <div id="map-container" class="card">
            <div class="card-body">
                 <div id="map" style="height: 450px; border-radius: 8px;"></div>
                 <div id="location-status" class="mt-3 text-center text-muted"></div>
            </div>
        </div>
        <div class="text-center mt-4">
            <button id="confirm-location-btn" class="btn btn-primary btn-lg">Confirm Location & Analyze Issue <i class="fas fa-search-location ms-2"></i></button>
        </div>
    </div>
    
    <!-- Loading Spinner -->
    <div id="loading" class="text-center py-5" style="display: none;">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status"></div>
        <h4 class="mt-3">Analyzing your report...</h4>
        <p class="text-muted">This may take a moment. We appreciate your patience.</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/report.js') }}"></script>
{% endblock %}
